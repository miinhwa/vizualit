<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Korea Visual Diary — 나의 한국 추억 지도</title>
  <meta name="description" content="따뜻한 감성의 인터랙티브 시각 일기 프레젠테이션" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bgTint: rgba(255,255,255,.58);    /* светлая вуаль поверх обоев */
      --ink:#463c36;
      --muted:#7a6e65;
      --beige:#efe6dd;
      --card:#ffffff;
      --dot:#d2c7bd;
      --dot-active:#7c6a5e;
      --shadow:0 18px 40px rgba(70,60,54,.18);
      --radius:26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
      /* обои на ВСЕХ слайдах */
      background: url("assets images/wall.jpg") center/cover fixed no-repeat;
    }
    /* мягкая вуаль + лёгкий градиент для читабельности */
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.48), rgba(255,255,255,.68)),
        var(--bgTint);
      backdrop-filter: saturate(115%) blur(1.6px);
    }

    /* верхние переключатели */
    .top-left{
      position:fixed; left:16px; top:16px; display:flex; gap:8px; z-index:5;
    }
    .chip{
      appearance:none; border:1px solid var(--beige); background:rgba(255,255,255,.8);
      backdrop-filter:saturate(120%) blur(6px);
      color:var(--ink);
      padding:10px 14px; border-radius:999px; font-size:14px; cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      transition:transform .12s ease, box-shadow .2s ease, background .2s ease;
    }
    .chip:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.08)}
    .chip[aria-pressed="true"]{background:#fff; border-color:#e7ddd3}

    /* центр: карточка-слайд */
    .wrap{
      position:fixed; inset:0; display:grid; place-items:center; padding:28px; z-index:1;
    }
    .card{
      width:min(960px,92vw);
      min-height:520px;
      max-height:78vh;
      background:var(--card);
      border:1px solid var(--beige);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:34px 34px 90px;
      overflow:hidden;
      position:relative;
      cursor:pointer;
      transition: box-shadow .25s ease, transform .25s ease, filter .28s ease, opacity .28s ease;
    }
    .card:hover{ box-shadow:0 22px 48px rgba(70,60,54,.24) }
    /* эффект «растворения в блюр» между слайдами */
    .card.is-blur{
      filter: blur(10px) saturate(.96);
      opacity:.60;
    }

    .slide{ opacity:0; transform:translateY(8px); transition:opacity .6s ease, transform .6s ease; }
    .slide.is-active{ opacity:1; transform:none; }

    .kicker{ font-size:14px; letter-spacing:.12em; text-transform:uppercase; color:var(--muted); margin-bottom:6px; }
    h1{ margin:4px 0 8px 0; line-height:1.2; font-size:32px; font-weight:700; }
    .sub{ font-size:18px; color:#5f5248; margin:0 0 14px 0; font-weight:600; }
    .body{ font-size:16px; line-height:1.8; color:#52483f; margin:8px 0 18px 0; white-space:pre-line; }

    /* милая галерея */
    .gallery{
      display:grid; gap:10px; grid-template-columns:repeat(3,1fr);
    }
    @media (max-width:820px){ .gallery{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:540px){ .gallery{grid-template-columns:1fr} }
    .gallery img{
      width:100%; height:180px; object-fit:cover; border-radius:16px; border:1px solid var(--beige);
      transition:transform .28s ease, box-shadow .28s ease, filter .28s ease;
      background:#f7f2ec;
    }
    .gallery img:hover{ transform:translateY(-2px) scale(1.02); box-shadow:0 10px 22px rgba(0,0,0,.08); filter:saturate(1.05) }

    /* подвал с прогрессом */
    .footer{
      position:absolute; left:0; right:0; bottom:0;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 18px;
      background:linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,.9));
      border-top:1px solid var(--beige);
    }
    .progress{ display:flex; gap:8px; align-items:center; }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--dot); transition:transform .2s ease, background .2s ease; }
    .dot.is-active{ background:var(--dot-active); transform:scale(1.2) }
    .next{
      appearance:none; border:none; border-radius:999px; padding:12px 18px;
      background:#fff; border:1px solid var(--beige);
      color:#4a3f37; font-weight:600; cursor:pointer;
      box-shadow:0 8px 20px rgba(0,0,0,.06);
      transition:transform .12s ease, box-shadow .2s ease, background .2s ease;
    }
    .next:hover{ transform:translateY(-1px); box-shadow:0 12px 24px rgba(0,0,0,.08)}
    .next:active{ transform:translateY(0)}

    /* стартовое окошко */
    .gate{
      position:fixed; inset:0; z-index:6; display:grid; place-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.88));
      backdrop-filter: blur(2px);
    }
    .gate-card{
      width:min(640px,92vw); background:#fff; border:1px solid var(--beige); border-radius:22px; box-shadow:var(--shadow);
      padding:28px; text-align:center;
    }
    .gate h2{margin:0 0 8px 0}
    .gate p{margin:0 0 18px 0; color:var(--muted)}
    .start{
      appearance:none; border:none; border-radius:12px; padding:14px 22px;
      background:#2f7df4; color:#fff; font-weight:700; font-size:16px; cursor:pointer;
      box-shadow:0 10px 24px rgba(47,125,244,.32);
      transition:transform .12s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .start:hover{transform:translateY(-1px); box-shadow:0 14px 28px rgba(47,125,244,.36)}
    .hide{display:none !important}
    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <!-- верхние переключатели -->
  <div class="top-left">
    <button class="chip" id="bgmBtn" type="button" aria-pressed="true">배경음악: 켜짐</button>
    <button class="chip" id="voiceBtn" type="button" aria-pressed="true">음성: 켜짐</button>
  </div>

  <!-- старт -->
  <div class="gate" id="gate">
    <div class="gate-card">
      <div class="kicker">Korea Visual Diary</div>
      <h2>나의 한국 추억 지도</h2>
      <p>시작을 누르면 부드러운 피아노 배경음악과 함께 슬라이드가 진행됩니다.</p>
      <button class="start" id="startBtn" type="button">시작하기</button>
      <div style="margin-top:10px; font-size:13px; color:#7b6e63">배경음악 음량 0.25, 한국어 음성 안내</div>
    </div>
  </div>

  <!-- карточка-слайд -->
  <div class="wrap">
    <article class="card" id="card" role="group" aria-label="슬라이드 카드">
      <div class="slide is-active" id="slide"></div>
      <footer class="footer">
        <div class="progress" id="progress" aria-label="진행 점 표시"></div>
        <button class="next" id="nextBtn" type="button" aria-label="다음 슬라이드">다음 ▶</button>
      </footer>
    </article>
  </div>

  <!-- музыка BTS инструментал -->
  <audio id="bgm" src="assets music/bts_instrumental.mp3" preload="auto" loop crossorigin="anonymous"></audio>
  <span class="sr-only" aria-live="polite" id="live"></span>

  <script>
    /* -------------------------------------------------
       СЛАЙДЫ (включая примеры и карты Kakao)
       ------------------------------------------------- */
    const slides = [
      {
        kicker:"INTRO",
        title:"Korea Visual Diary 소개",
        subtitle:"따뜻한 시각 일기로 만나는 나의 한국 추억 지도",
        text:"이 페이지는 내가 한국에서 보낸 시간을 작은 지도 위에 기록한 시각 일기입니다.\n감정과 장소, 시간을 함께 엮어 ‘나만의 지도’를 만들어 보았습니다.\n부드러운 배경과 작은 움직임 속에서, 천천히 나의 이야기를 들어 주세요.",
        images:["assets images/ex1.jpg","assets images/ex2.jpg"]
      },
      {
        kicker:"STORY",
        title:"프로젝트 배경과 동기",
        subtitle:"왜 지도로 기억을 정리할까?",
        text:"장소는 기억을 붙잡는 닻과 같습니다. 카페의 조용한 오후, 강변의 바람, 낯선 골목의 간판…\n지도 형식으로 정리하면 기억의 조각들이 연결되어 흐름을 만들고, 감정의 온도도 더 선명해집니다.",
        images:["assets images/map1.jpg"]
      },
      {
        kicker:"INSPIRATION",
        title:"영감 (Kakao Map)",
        subtitle:"친숙한 인터랙션, 감성적인 재해석",
        text:"카카오맵의 인터랙션과 정보 구조에서 영감을 받았습니다.\n다만 정보 중심이 아닌 감정 중심으로 재구성하여, 부드럽고 여백이 있는 화면을 지향합니다.",
        images:["assets images/map2.jpg","assets images/map3.jpg"]
      },
      {
        kicker:"CONCEPT",
        title:"개념 (인터랙티브 추억 지도)",
        subtitle:"장소 × 시간 × 감정",
        text:"핵심은 세 가지 축입니다.\n1) 장소 좌표와 메모  2) 방문 시점  3) 그 순간의 감정 태그\n이 세 가지가 만나면 ‘나만의 서사 지도’가 됩니다.",
        images:["assets images/map4.jpg"]
      },
      {
        kicker:"STYLE",
        title:"디자인과 스타일",
        subtitle:"소프트 베이지와 잔잔한 움직임",
        text:"배경은 따뜻한 회화적 질감의 사진(Oboi), 카드 UI는 라운드/소프트 쉐도우.\n콘텐츠는 라운드 카드를 중심으로, 여백과 타이포그래피의 호흡을 살렸습니다."
      },
      {
        kicker:"DATA",
        title:"데이터 구조 (places.json)",
        subtitle:"가볍고 직관적인 스키마",
        text:"예시 스키마\n[\n  { id, title, coords:[lat,lng], date, mood:'평온/설렘/그리움', note }\n]\n작고 단순한 구조로 시작해 점차 확장합니다."
      },
      {
        kicker:"PLAN",
        title:"타임라인 (3주 계획)",
        subtitle:"설계 — 구현 — 다듬기",
        text:"1주차: 자료 수집, 스키마 확정, 와이어프레임\n2주차: 인터랙션 구현(줌/핀/툴팁), 스타일링\n3주차: 내러티브 정제, 접근성/성능 개선"
      },
      {
        kicker:"PREVIEW",
        title:"미리보기 (예시 화면)",
        subtitle:"핀, 카드, 타이밍의 연결",
        text:"핀을 선택하면 카드가 열리고, 타임라인에서 지난 기록을 빠르게 탐색할 수 있습니다.\n이 화면은 감정을 중심으로 색을 달리하여 맥락을 제시합니다.",
        images:["assets images/ex2.jpg","assets images/map1.jpg"]
      },
      {
        kicker:"LEARNING",
        title:"학습과 느낀 점",
        subtitle:"지도는 기억을 걷게 하는 길",
        text:"장소를 다시 걷는 경험은 생각보다 선명했습니다.\n작은 디테일들이 감정을 환기시키고, 기록은 다시 현재를 비춥니다."
      },
      {
        kicker:"THANKS",
        title:"마무리 (감사 인사)",
        subtitle:"함께 걸어주셔서 고맙습니다",
        text:"이 시각 일기를 통해 누군가의 한국도 따뜻하게 기억되기를 바랍니다.\n끝까지 봐 주셔서 감사합니다. 다시 처음으로 돌아가 이야기를 이어가겠습니다."
      }
    ];

    /* -------------------------------------------------
       СОСТОЯНИЕ / ЭЛЕМЕНТЫ
       ------------------------------------------------- */
    let idx = 0, autoTimer = null, voiceOn = true, bgmOn = true, koVoice = null;

    const slideEl   = document.getElementById('slide');
    const progressEl= document.getElementById('progress');
    const nextBtn   = document.getElementById('nextBtn');
    const card      = document.getElementById('card');
    const bgmBtn    = document.getElementById('bgmBtn');
    const voiceBtn  = document.getElementById('voiceBtn');
    const bgm       = document.getElementById('bgm');
    const startBtn  = document.getElementById('startBtn');
    const gate      = document.getElementById('gate');
    const live      = document.getElementById('live');

    /* -------------------------------------------------
       ПРОГРЕСС-ТОЧКИ
       ------------------------------------------------- */
    function buildDots(){
      progressEl.innerHTML = '';
      slides.forEach((_,i)=>{
        const d = document.createElement('div');
        d.className = 'dot' + (i===idx?' is-active':'');
        d.setAttribute('role','button');
        d.setAttribute('aria-label',(i+1)+'번째 슬라이드로 이동');
        d.tabIndex = 0;
        d.addEventListener('click', (e)=>{ e.stopPropagation(); go(i); });
        d.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); go(i);} });
        progressEl.appendChild(d);
      });
    }

    /* -------------------------------------------------
       РЕНДЕР + ПЛАВНЫЙ BLUR-ПЕРЕХОД
       ------------------------------------------------- */
    function render(){
      const s = slides[idx];

      // blur-растворение старого содержимого
      card.classList.add('is-blur');

      setTimeout(()=>{
        slideEl.classList.remove('is-active');
        slideEl.innerHTML = `
          <div class="kicker">${escapeHTML(s.kicker||'')}</div>
          <h1>${escapeHTML(s.title||'')}</h1>
          ${s.subtitle ? `<div class="sub">${escapeHTML(s.subtitle)}</div>`:''}
          ${s.text ? `<div class="body">${escapeHTML(s.text)}</div>`:''}
          ${Array.isArray(s.images) && s.images.length ? `
            <div class="gallery">
              ${s.images.slice(0,3).map(src=>`<img src="${src}" alt="슬라이드 이미지" loading="lazy">`).join('')}
            </div>
          `:''}
        `;
        slideEl.classList.add('is-active');
        // обновить точки
        [...progressEl.children].forEach((el,i)=> el.classList.toggle('is-active', i===idx));
        // снять blur плавно
        setTimeout(()=> card.classList.remove('is-blur'), 20);

        // озвучка и авто-переход
        speakSlide(s);
        clearTimeout(autoTimer);
        autoTimer = setTimeout(next, 15000);
        live.textContent = (s.title||'') + ' - ' + (s.subtitle||'');
      }, 220); // время «растворения» старого слайда
    }

    function next(){ idx = (idx + 1) % slides.length; render(); }
    function go(i){ idx = (i + slides.length) % slides.length; render(); }

    /* -------------------------------------------------
       WEB SPEECH TTS (ko)
       ------------------------------------------------- */
    function pickKoreanVoice(){
      const list = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      const koList = list.filter(v => /ko/i.test(v.lang||'')); // ko-KR приоритет
      return koList[0] || list.find(v=>/Korean|ko/i.test(v.name||'')) || null;
    }
    function speak(text){
      if(!('speechSynthesis' in window)) return;
      speechSynthesis.cancel();
      if(!voiceOn || !text) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ko-KR'; if(koVoice) u.voice = koVoice;
      u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
      speechSynthesis.speak(u);
    }
    function speakSlide(s){
      const narration = [s.title, s.subtitle, s.text].filter(Boolean).join('. ');
      speak(narration);
    }

    /* -------------------------------------------------
       ХЕЛПЕРЫ
       ------------------------------------------------- */
    function escapeHTML(str){
      return String(str).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }

    /* -------------------------------------------------
       УПРАВЛЕНИЕ
       ------------------------------------------------- */
    nextBtn.addEventListener('click', e=>{ e.stopPropagation(); next(); });
    card.addEventListener('click', ()=> next());
    document.addEventListener('keydown', e=>{
      if(e.key === 'ArrowRight' || e.key === ' ') next();
      if(e.key === 'ArrowLeft') go(idx-1);
    });

    bgmBtn.addEventListener('click', e=>{
      bgmOn = !bgmOn;
      bgmBtn.setAttribute('aria-pressed', String(bgmOn));
      bgmBtn.textContent = bgmOn ? '배경음악: 켜짐' : '배경음악: 꺼짐';
      if(bgmOn){ try{ bgm.play(); }catch{} } else { bgm.pause(); }
    });

    voiceBtn.addEventListener('click', e=>{
      voiceOn = !voiceOn;
      voiceBtn.setAttribute('aria-pressed', String(voiceOn));
      voiceBtn.textContent = voiceOn ? '음성: 켜짐' : '음성: 꺼짐';
      if(!voiceOn && 'speechSynthesis' in window){ speechSynthesis.cancel(); }
      if(voiceOn) speakSlide(slides[idx]);
    });

    /* -------------------------------------------------
       СТАРТ
       ------------------------------------------------- */
    startBtn.addEventListener('click', async ()=>{
      document.getElementById('gate').classList.add('hide');
      try{ bgm.volume = 0.25; if(bgmOn) await bgm.play(); }catch{}
      if('speechSynthesis' in window){
        koVoice = pickKoreanVoice();
        window.speechSynthesis.onvoiceschanged = ()=>{ koVoice = pickKoreanVoice(); };
      }
      buildDots();
      render();
    });

    // предварительный показ (без озвучки)
    (function init(){
      buildDots();
      const s = slides[0];
      slideEl.innerHTML = `
        <div class="kicker">${escapeHTML(s.kicker||'')}</div>
        <h1>${escapeHTML(s.title||'')}</h1>
        ${s.subtitle ? `<div class="sub">${escapeHTML(s.subtitle)}</div>`:''}
        <div class="body" style="opacity:.85">시작하기 버튼을 눌러 배경음악과 음성 안내를 켜세요.</div>
        ${Array.isArray(s.images) && s.images.length ? `
          <div class="gallery">
            ${s.images.slice(0,3).map(src=>`<img src="${src}" alt="슬라이드 이미지" loading="lazy">`).join('')}
          </div>
        `:''}
      `;
      slideEl.classList.add('is-active');
    })();
  </script>
</body>
</html>
