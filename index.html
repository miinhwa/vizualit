<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Presentation</title>
    <style>
        :root {
            --veil: rgba(0,0,0,0.35);
            --card-bg: rgba(255,255,255,0.75);
            --card-blur: 10px;
            --radius: 18px;
            --shadow: 0 10px 30px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.12);
            --transition-fast: 220ms;
            --transition-med: 420ms;
            --accent: #6b7cff;
            --text: #1f2937;
            --muted: #6b7280;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--text);
            background: #000;
            overflow: hidden;
        }

        .bg {
            position: fixed;
            inset: 0;
            background-image: url("assets images/wall.jpg");
            background-size: cover;
            background-position: center;
            will-change: transform;
            transform: scale(1.02);
        }
        .veil {
            position: fixed;
            inset: 0;
            background: var(--veil);
        }

        .stage {
            position: relative;
            height: 100%;
            width: 100%;
            display: grid;
            place-items: center;
            padding: 24px;
        }

        .card {
            width: min(980px, 92vw);
            min-height: 60vh;
            background: var(--card-bg);
            backdrop-filter: blur(var(--card-blur)) saturate(1.1);
            -webkit-backdrop-filter: blur(var(--card-blur)) saturate(1.1);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: grid;
            grid-template-rows: auto 1fr auto;
            transition: filter var(--transition-med) ease, opacity var(--transition-med) ease;
        }
        .card.blur {
            filter: blur(16px) opacity(0.35);
        }

        .card-header {
            padding: 18px 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.2px;
        }
        .toggles {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--muted);
            flex-wrap: wrap;
        }
        .toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(255,255,255,0.6);
            border-radius: 999px;
            border: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            user-select: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.08) inset;
        }
        .toggle .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #bbb;
            transition: background var(--transition-fast) ease;
        }
        .toggle.active .dot { background: #10b981; }

        .card-body {
            padding: 10px 22px 0 22px;
            display: grid;
            grid-template-rows: auto 1fr;
            row-gap: 8px;
        }
        .intro {
            padding: 16px 0 6px 0;
            color: var(--muted);
        }

        .gallery {
            width: 100%;
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(3, 1fr);
            align-items: stretch;
            justify-items: center;
            padding: 8px 0 18px 0;
        }
        .gallery img {
            width: 100%;
            height: 240px;
            object-fit: cover;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.18);
            background: #f3f4f6;
        }
        @media (max-width: 820px) {
            .gallery img { height: 180px; }
        }
        @media (max-width: 640px) {
            .gallery { grid-template-columns: 1fr; }
            .gallery img { height: 220px; }
        }

        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 14px;
            padding: 14px 18px 18px 18px;
        }
        .progress {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(0,0,0,0.18);
            transition: transform var(--transition-fast) ease, background var(--transition-fast) ease;
        }
        .dot.active {
            background: var(--accent);
            transform: scale(1.25);
        }

        .actions { display: inline-flex; align-items: center; gap: 10px; }
        .btn {
            appearance: none;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            background: var(--accent);
            color: white;
            box-shadow: 0 6px 16px rgba(107,124,255,0.35);
            transition: transform var(--transition-fast) ease, box-shadow var(--transition-fast) ease, opacity var(--transition-fast) ease;
        }
        .btn:active { transform: translateY(1px); }
        .btn.secondary {
            background: rgba(0,0,0,0.08);
            color: #111827;
            box-shadow: none;
        }

        .start-wrap { display: grid; place-items: center; padding: 22px; }
        .hint { color: var(--muted); font-size: 14px; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="bg" aria-hidden="true"></div>
    <div class="veil" aria-hidden="true"></div>

    <div class="stage">
        <section class="card" id="card">
            <header class="card-header">
                <div class="title">프레젠테이션</div>
                <div class="toggles">
                    <div id="musicToggle" class="toggle" role="button" aria-pressed="false" tabindex="0">
                        <span>배경음악:</span>
                        <span id="musicState">꺼짐</span>
                        <span class="dot" aria-hidden="true"></span>
                    </div>
                    <div id="voiceToggle" class="toggle" role="button" aria-pressed="false" tabindex="0">
                        <span>음성:</span>
                        <span id="voiceState">꺼짐</span>
                        <span class="dot" aria-hidden="true"></span>
                    </div>
                </div>
            </header>

            <div class="card-body">
                <div class="intro" id="slideTitle">슬라이드 1</div>
                <div class="gallery" id="gallery"></div>
                <div class="start-wrap" id="startWrap">
                    <button class="btn" id="startBtn">시작하기</button>
                    <div class="hint">버튼을 클릭하면 배경음악이 시작됩니다.</div>
                </div>
            </div>

            <footer class="card-footer">
                <div class="progress" id="progress"></div>
                <div class="actions">
                    <button id="nextBtn" class="btn">다음 ▶</button>
                </div>
            </footer>
        </section>
    </div>

    <script>
        // Slides data: up to 3 images per slide; paths have spaces and must remain quoted
        const slides = [
            { images: ["assets images/ex1.jpg", "assets images/ex2.jpg"], tts: "첫 번째 슬라이드입니다." },
            { images: ["assets images/map1.jpg"], tts: "두 번째 슬라이드입니다." },
            { images: ["assets images/map2.jpg", "assets images/map3.jpg"], tts: "세 번째 슬라이드입니다." },
            { images: ["assets images/map4.jpg"], tts: "마지막 슬라이드입니다." }
        ];

        // Elements
        const card = document.getElementById('card');
        const gallery = document.getElementById('gallery');
        const slideTitle = document.getElementById('slideTitle');
        const progress = document.getElementById('progress');
        const nextBtn = document.getElementById('nextBtn');
        const startWrap = document.getElementById('startWrap');
        const startBtn = document.getElementById('startBtn');
        const musicToggle = document.getElementById('musicToggle');
        const musicState = document.getElementById('musicState');
        const voiceToggle = document.getElementById('voiceToggle');
        const voiceState = document.getElementById('voiceState');

        // Audio
        const bgm = new Audio("assets music/bts_instrumental.mp3");
        bgm.loop = true;
        bgm.volume = 0.25; // default volume

        // State
        let index = 0;
        let musicOn = false;
        let voiceOn = false;
        let voicesReady = false;
        let koVoice = null;

        // Build progress dots
        function buildDots() {
            progress.innerHTML = '';
            slides.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = 'dot' + (i === index ? ' active' : '');
                progress.appendChild(d);
            });
        }

        // Render current slide
        function renderSlide(animate = true) {
            if (animate) card.classList.add('blur');

            const slide = slides[index];
            slideTitle.textContent = `슬라이드 ${index + 1}`;

            // Render up to 3 images
            gallery.innerHTML = '';
            (slide.images || []).slice(0, 3).forEach((src) => {
                const img = document.createElement('img');
                img.alt = 'slide image';
                img.decoding = 'async';
                img.loading = 'lazy';
                img.src = src; // keep quotes in literal definitions
                gallery.appendChild(img);
            });

            // Update dots
            Array.from(progress.children).forEach((d, i) => {
                d.classList.toggle('active', i === index);
            });

            // Speak if enabled
            if (voiceOn) speakSlide(slide);

            // End animation
            if (animate) setTimeout(() => card.classList.remove('blur'), 200);
        }

        // Next slide
        function nextSlide() {
            index = (index + 1) % slides.length;
            renderSlide(true);
        }

        // TTS helpers
        function pickKoVoice() {
            try {
                const all = window.speechSynthesis.getVoices();
                koVoice = all.find(v => (v.lang || '').toLowerCase().startsWith('ko')) || null;
                voicesReady = true;
            } catch (_) {
                voicesReady = false;
                koVoice = null;
            }
        }

        function speakSlide(slide) {
            if (!('speechSynthesis' in window)) return;
            if (!voiceOn) return;
            try { window.speechSynthesis.cancel(); } catch (_) {}
            const text = slide.tts || `슬라이드 ${index + 1}`;
            try {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ko-KR';
                if (koVoice) u.voice = koVoice;
                u.rate = 1.0;
                u.pitch = 1.0;
                window.speechSynthesis.speak(u);
            } catch (_) {
                // Fail silently if TTS not available
            }
        }

        // Event wiring
        nextBtn.addEventListener('click', nextSlide);

        startBtn.addEventListener('click', async () => {
            startWrap.style.display = 'none';
            try {
                await bgm.play();
                musicOn = true;
                musicToggle.classList.add('active');
                musicToggle.setAttribute('aria-pressed', 'true');
                musicState.textContent = '켜짐';
            } catch (_) {
                // Autoplay blocked or error; remain off without crashing
            }
        });

        function toggleMusic() {
            if (!musicOn) {
                bgm.play().then(() => {
                    musicOn = true;
                    musicToggle.classList.add('active');
                    musicToggle.setAttribute('aria-pressed', 'true');
                    musicState.textContent = '켜짐';
                }).catch(() => {
                    // ignore
                });
            } else {
                try { bgm.pause(); } catch (_) {}
                musicOn = false;
                musicToggle.classList.remove('active');
                musicToggle.setAttribute('aria-pressed', 'false');
                musicState.textContent = '꺼짐';
            }
        }

        function toggleVoice() {
            voiceOn = !voiceOn;
            voiceToggle.classList.toggle('active', voiceOn);
            voiceToggle.setAttribute('aria-pressed', voiceOn ? 'true' : 'false');
            voiceState.textContent = voiceOn ? '켜짐' : '꺼짐';
            if (!('speechSynthesis' in window)) return;
            try { window.speechSynthesis.cancel(); } catch (_) {}
            if (voiceOn) speakSlide(slides[index]);
        }

        musicToggle.addEventListener('click', toggleMusic);
        musicToggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleMusic(); } });
        voiceToggle.addEventListener('click', toggleVoice);
        voiceToggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleVoice(); } });

        // Initialize
        buildDots();
        renderSlide(false);

        // Prepare voices
        if ('speechSynthesis' in window) {
            pickKoVoice();
            window.speechSynthesis.onvoiceschanged = () => { pickKoVoice(); };
        }
    </script>
</body>
</html>


